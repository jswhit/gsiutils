<!doctype html>
<HTML>

    <!--====================================================================================
    == 12/2014, per WebStorm this document is now HTML5 compliant, using an embedded
    == ccs (cascading style sheet) to replace all deprecated html presentation tags.
    =====================================================================================-->

    <head>
        <!-- ************************************************************-->
        <!-- Make Summary Plots via Google Charts (javascript extension) -->
        <!-- ************************************************************-->


        <!-- load google chart api and local copy of jsuri.js -->
        <script type="text/javascript" src="https://www.google.com/jsapi"></script>
        <script type="text/javascript" src="jsuri-1.1.1.js"></script>

        <script type="text/javascript">

            google.load("visualization", "1", {packages:["corechart"]});

            // on document load event fire the drawCharts() function
            google.setOnLoadCallback(drawCharts);


            // array for retrieved data from the csv file
            var dataProvider  = [];
            var data;
            var data2;
            var data3;
            var data4;

            var url    = window.location.href;
            var src    = new Uri( url ).getQueryParamValue('sat');
            var initialLoad = true;

            //log( src );


            /****************************************************************************************
             ****************************************************************************************
             *
             *  drawCharts()
             *
             *    Top level drawing function, fired by initial page load and any user change in the
             *    check boxes.
             ****************************************************************************************
             ****************************************************************************************/
            function drawCharts() {


                /***********************************************************************************************
                 * loadCSV()
                 *
                 *   loads data from the input comma separated value file
                 ***********************************************************************************************/
                function loadCSV(file) {
                    var request;
                    var request2;

                    dataProvider = new Array(2);
                    dataProvider[0] = [];
                    dataProvider[1] = [];

                    if (window.XMLHttpRequest) {
                        // IE7+, Firefox, Chrome, Opera, Safari
                        request  = new XMLHttpRequest();
                        request2 = new XMLHttpRequest();
                    }
                    else {
                        // code for IE6, IE5
                        request  = new ActiveXObject('Microsoft.XMLHTTP');
                        request2 = new ActiveXObject('Microsoft.XMLHTTP');
                    }


                    // load file
                    //   The request object is used to get the file from the server.  Note that this is object oriented
                    //   programming, not procedural.
                    //
                    //   The request.open sets the server instruction to get the requested data file asynchronously.
                    //   Synchronous requests are still possible but most browsers have deprecated that option and will
                    //   eventually remove it.
                    //
                    //   The request.onload() function specifies the actions to take when the data file is loaded;
                    //   the request.status of 200 indicates the load was successful, and request.readystate 4
                    //   indicates the transaction is complete.  The readyState test is included as a sanity check;
                    //   the onload function should only fire when the load is complete or terminated.  The check
                    //   on request.status is necessary; there's no guarantee that the request was successful.
                    //   A warning is dumped to the log in the event of failure, but unless the user has a web
                    //   console (term may vary with browser) open s/he won't see it.
                    //
                    //   The request.send() method actually initiates the processing of the request.

                    request.open('GET', file, true);
                    log( 'loading ' + file );


                    var idx = 0;
                    request.onload = function(e) {
                        if( request.status === 200 && request.readyState === 4 ) {
                            idx = 0;
                            parseCSV( request.responseText, idx );
                            fillData( idx );
                            fillCharts( );  // call this after the comp file is loaded (below)


                        }
                        else {
                            log (" Failed to load " + file + " ; request.status = " + request.status );
                        }
                    }
                    request.send();

                }


                /************************************************************************************
                 *  parseCSV( idx )
                 *
                 *    load the comma separated value (CSV) file data into the dataProvider[] array.
                 *    idx should be 0 or 1 for the requested data set or the comparison data set.
                 ************************************************************************************/
                function parseCSV( data, idx ){

                    log("--> parseCSV, idx = " + idx );
                    //replace UNIX new lines
                    data = data.replace(/\r\n/g, "\n");
                    //replace MAC new lines
                    data = data.replace(/\r/g, "\n");
                    //split into rows
                    var rows = data.split("\n");
                    //log( rows.length );
                    var nchanl = 0;


                    // load line 0, which includes the number of channels, and 4 10-digit cycle times
                    if (rows[0]) {
                        var column = rows[0].split(",");
                        var nchanl = parseInt(column[0]);
                        var cycle1 = column[1];
                        var cycle2 = column[2];
                        var cycle3 = column[3];
                        var cycle4 = column[4];

                        // create object which contains all these items:
                        var dataObject = {nchanl: nchanl, cycle1: cycle1, cycle2: cycle2, cycle3: cycle3, cycle4: cycle4};

                        // add object to dataProvider array
                        dataProvider[idx].push(dataObject);
                        log( 'idx, dataProvider[idx][0].nchanl = ' + idx + ', ' + dataProvider[idx][0].nchanl );
                        log( 'idx, dataProvider[idx][0].cycle1 = ' + idx + ', ' + dataProvider[idx][0].cycle1 );
                        log( 'idx, dataProvider[idx][0].cycle4 = ' + idx + ', ' + dataProvider[idx][0].cycle4 );
                    }

                    // loop through rows 1 - nchanl to load the count data (chart 1)
                    for (var i = 1; i <= nchanl; i++) {
                        // this line helps to skip empty rows
                        if (rows[i]) {
                            // our columns are separated by comma
                            var column = rows[i].split(",");

                            // data element order is channel, use flag, cnt cycle1, cnt cycle2, cnt cycl3, cnt cycl4
                            //   items 1-nchan + 1 are the cycle counts for ges data
                            var chan = Number(column[0]);
                            var use = Number(column[1]);
                            var assim;
                            var notassim;
                            if (use === 1) {
                                assim = 1;
                                notassim = undefined;
                            }
                            else {
                                assim = undefined;
                                notassim = 1;
                            }


                            //log( "column.length = " + column.length);

                            var gcyc1 = Number(column[2]);
                            var gcyc2 = Number(column[3]);
                            var gcyc3 = Number(column[4]);
                            var gcyc4 = Number(column[5]);
                            var acyc1 = Number(column[6]);
                            var acyc2 = Number(column[7]);
                            var acyc3 = Number(column[8]);
                            var acyc4 = Number(column[9]);

                            // create object which contains all these items, plus undefined entries for
                            // chart2-4 data:
                            var dataObject = {chan: chan, use: use, assim: assim, notassim: notassim,
                                gcyc1: gcyc1, gcyc2: gcyc2, gcyc3: gcyc3, gcyc4: gcyc4,
                                acyc1: acyc1, acyc2: acyc2, acyc3: acyc3, acyc4: acyc4,
                                // chart 2
                                gtcor1cyc: undefined, gtcor1day: undefined, gtcor30day: undefined,
                                atcor1cyc: undefined, atcor1day: undefined, atcor30day: undefined,
                                // chart 3
                                avg_omgbc_1cyc: undefined, sdv_omgbc_1cyc: undefined,
                                avg_omgbc_30day: undefined, sdv_omgbc_30day: undefined,
                                avg_omabc_1cyc: undefined, sdv_omabc_1cyc: undefined,
                                avg_omabc_30day: undefined, sdv_omabc_30day: undefined,
                                // chart 4
                                ges_pen_1cyc: undefined, ges_pen_1day: undefined, ges_pen_30day: undefined,
                                anl_pen_1cyc: undefined, anl_pen_1day: undefined, anl_pen_30day: undefined};

                            // add object to dataProvider array
                            dataProvider[idx].push(dataObject);
                        }
                    }

                    // loop through rows nchanl+1 - 2*nchanl to load the total bias correction data (chart 2)
                    for (var i = nchanl + 1; i <= 2 * nchanl; i++) {
                        // this line helps to skip empty rows
                        if (rows[i]) {
                            var column = rows[i].split(",");
                            // data element order is channel, use flag, ges:tot_cor:1cycle, ges:tot_cor:4 cycles,
                            //   ges:tot_cor:120 cycles, anl:tot_cor:1 cycle, anl:tot_cor:4 anl:tot_cor:120 cycles

                            dataProvider[idx][i - nchanl].gtcor1cyc = Number(column[2]);
                            dataProvider[idx][i - nchanl].gtcor1day = Number(column[3]);
                            dataProvider[idx][i - nchanl].gtcor30day = Number(column[4]);
                            dataProvider[idx][i - nchanl].atcor1cyc = Number(column[5]);
                            dataProvider[idx][i - nchanl].atcor1day = Number(column[6]);
                            dataProvider[idx][i - nchanl].atcor30day = Number(column[7]);

                        }
                    }

                    // loop through rows nchan*2+1 - 3*nchanl to load the ob[g|a]bc data (chart 3)
                    for (var i = (2 * nchanl) + 1; i <= 3 * nchanl; i++) {
                        // this line helps to skip empty rows
                        if (rows[i]) {
                            var column = rows[i].split(",");
                            // data element order is channel, use flag, avg_omgbc:1cycle, sdv_omgbc:1 cycle,
                            //   avg_omgbc:120 cycles, sdv_omgbc:120 cycles, avg_omabc:1 cycle, sdv_omabc: 1 cycle,
                            //   avg_omabc:120 cycles, sdv_omabc:120 cycles

                            dataProvider[idx][i - nchanl * 2].avg_omgbc_1cyc = Number(column[2]);
                            dataProvider[idx][i - nchanl * 2].sdv_omgbc_1cyc = Number(column[3]);
                            dataProvider[idx][i - nchanl * 2].avg_omgbc_30day = Number(column[4]);
                            dataProvider[idx][i - nchanl * 2].sdv_omgbc_30day = Number(column[5]);
                            dataProvider[idx][i - nchanl * 2].avg_omabc_1cyc = Number(column[6]);
                            dataProvider[idx][i - nchanl * 2].sdv_omabc_1cyc = Number(column[7]);
                            dataProvider[idx][i - nchanl * 2].avg_omabc_30day = Number(column[8]);
                            dataProvider[idx][i - nchanl * 2].sdv_omabc_30day = Number(column[9]);
                        }
                    }

                    // loop through rows nchan*3+1 - 4*nchanl to load the penalty data (chart 4)
                    for (var i = (3 * nchanl) + 1; i <= 4 * nchanl; i++) {
                        // this line helps to skip empty rows
                        if (rows[i]) {
                            var column = rows[i].split(",");
                            // data element order is channel, use flag, ges pen:1cycle, ges pen:1 day,
                            //   ges pen:120 cycles, anl pen:1 cycle, anl pen:1 day, anl pen:120 cycles
                            dataProvider[idx][i - nchanl * 3].ges_pen_1cyc = Number(column[2]);
                            dataProvider[idx][i - nchanl * 3].ges_pen_1day = Number(column[3]);
                            dataProvider[idx][i - nchanl * 3].ges_pen_30day = Number(column[4]);
                            dataProvider[idx][i - nchanl * 3].anl_pen_1cyc = Number(column[5]);
                            dataProvider[idx][i - nchanl * 3].anl_pen_1day = Number(column[6]);
                            dataProvider[idx][i - nchanl * 3].anl_pen_30day = Number(column[7]);
                        }
                    }
                    log("<-- parseCSV");
                }

                //----------------------------------------------------------------------------------------
                // fillData( idx )
                //
                //    fill the data, data2, data3, and data4 objects using the dataProvider object.
                //    idx should be 0 or 1 for the requested data or the comparison data set.
                //----------------------------------------------------------------------------------------
                function fillData( idx ){
                    log( "--> fillData, idx = " + idx );

                    // data is the container for the first chart's information.
                    data = new google.visualization.DataTable();
                    data.addColumn('number', 'chan');
                    data.addColumn('number', 'chan assim');
                    data.addColumn('number', 'chan not assim');
                    data.addColumn('number', 'ges ' + dataProvider[idx][0].cycle1);
                    data.addColumn('number', 'ges ' + dataProvider[idx][0].cycle2);
                    data.addColumn('number', 'ges ' + dataProvider[idx][0].cycle3);
                    data.addColumn('number', 'ges ' + dataProvider[idx][0].cycle4);
                    data.addColumn('number', 'anl ' + dataProvider[idx][0].cycle1);
                    data.addColumn('number', 'anl ' + dataProvider[idx][0].cycle2);
                    data.addColumn('number', 'anl ' + dataProvider[idx][0].cycle3);
                    data.addColumn('number', 'anl ' + dataProvider[idx][0].cycle4);

                    for (var ii = 1; ii < dataProvider[idx].length; ii++) {
                        data.addRows([
                            [Number(dataProvider[idx][ii].chan),
                                Number(dataProvider[idx][ii].assim), Number(dataProvider[idx][ii].notassim),
                                Number(dataProvider[idx][ii].gcyc1), Number(dataProvider[idx][ii].gcyc2),
                                Number(dataProvider[idx][ii].gcyc3), Number(dataProvider[idx][ii].gcyc4),
                                Number(dataProvider[idx][ii].acyc1), Number(dataProvider[idx][ii].acyc2),
                                Number(dataProvider[idx][ii].acyc3), Number(dataProvider[idx][ii].acyc4)
                            ]
                        ]);
                    }

                    // load data2 for chart2
                    data2 = new google.visualization.DataTable();
                    data2.addColumn('number', 'chan');
                    data2.addColumn('number', 'ges 1cyc');
                    data2.addColumn('number', 'ges 1day');
                    data2.addColumn('number', 'ges 30day');
                    data2.addColumn('number', 'anl 1cyc');
                    data2.addColumn('number', 'anl 1day');
                    data2.addColumn('number', 'anl 30day');
                    for (var ii = 1; ii < dataProvider[idx].length; ii++) {
                        data2.addRows([
                            [Number(dataProvider[idx][ii].chan),
                                Number(dataProvider[idx][ii].gtcor1cyc), Number(dataProvider[idx][ii].gtcor1day),
                                Number(dataProvider[idx][ii].gtcor30day), Number(dataProvider[idx][ii].atcor1cyc),
                                Number(dataProvider[idx][ii].atcor1day), Number(dataProvider[idx][ii].atcor30day)]
                        ]);
                    }

                    // load data3 for chart3
                    data3 = new google.visualization.DataTable();
                    data3.addColumn('number', 'chan');
                    data3.addColumn('number', 'avg omgbc 1cyc');
                    data3.addColumn('number', 'sdv omgbc 1cyc');
                    data3.addColumn('number', 'avg omgbc 30day');
                    data3.addColumn('number', 'sdv omgbc 30day');
                    data3.addColumn('number', 'avg omabc 1cyc');
                    data3.addColumn('number', 'sdv omabc 1cyc');
                    data3.addColumn('number', 'avg omabc 30day');
                    data3.addColumn('number', 'sdv omabc 30day');

                    for (var ii = 1; ii < dataProvider[idx].length; ii++) {
                        data3.addRows([
                            [Number(dataProvider[idx][ii].chan),
                                Number(dataProvider[idx][ii].avg_omgbc_1cyc), Number(dataProvider[idx][ii].sdv_omgbc_1cyc),
                                Number(dataProvider[idx][ii].avg_omgbc_30day), Number(dataProvider[idx][ii].sdv_omgbc_30day),
                                Number(dataProvider[idx][ii].avg_omabc_1cyc), Number(dataProvider[idx][ii].sdv_omabc_1cyc),
                                Number(dataProvider[idx][ii].avg_omabc_30day), Number(dataProvider[idx][ii].sdv_omabc_30day)]
                        ]);
                    }

                    // load data4 for chart4
                    data4 = new google.visualization.DataTable();
                    data4.addColumn('number', 'chan');
                    data4.addColumn('number', 'ges_1cyc');
                    data4.addColumn('number', 'ges_1day');
                    data4.addColumn('number', 'ges_30day');
                    data4.addColumn('number', 'anl_1cyc');
                    data4.addColumn('number', 'anl_1day');
                    data4.addColumn('number', 'anl_30day');

                    for (var ii = 1; ii < dataProvider[idx].length; ii++) {
                        data4.addRows([
                            [Number(dataProvider[idx][ii].chan),
                                Number(dataProvider[idx][ii].ges_pen_1cyc), Number(dataProvider[idx][ii].ges_pen_1day),
                                Number(dataProvider[idx][ii].ges_pen_30day), Number(dataProvider[idx][ii].anl_pen_1cyc),
                                Number(dataProvider[idx][ii].anl_pen_1day), Number(dataProvider[idx][ii].anl_pen_30day)]
                        ]);
                    }
                    log( "<-- fillData" );
                }


                //---------------------------------------------------------------------------------------
                // fillCharts()
                //   using the loaded data set, construct views (limited data sets) according to the
                //   state of the various checkboxes in the user interface.
                //---------------------------------------------------------------------------------------
                function fillCharts() {
                    //log( "-->fillCharts");

                    /*
                     * options are display options for entire chart
                     * including title, vertical axis label format and scale
                     */
                    var options = {
                        title: 'Number of Observations Passing QC',
                        titleTextStyle:{ fontSize: 20 },
                        series: {
                            0: { pointSize: 10, pointShape: { type: 'square' }, color: 'green', lineWidth: 0 },
                            1: { pointSize: 10, pointShape: { type: 'square' }, color: 'red', lineWidth: 0}
                        },
                        vAxis:{ format          : '0.##E+0',
                            logScale        : 'true'},
                        hAxis:{ title           : 'Channel',
                            format          :  '##',
                            showTextEvery   :  1
                        }
                    };

                    // chart is the count line chart.
                    var chart1 = new google.visualization.LineChart(
                            document.getElementById('sum_count'));

                    window.myValue = data;

                    // add callback for mouse events
                    //google.visualization.events.addListener(chart1, 'select', selectHandler);

                    // create a view for the display of only selected values
                    var myView = new google.visualization.DataView( window.myValue );

                    //
                    // Poll all the checkboxes and set the columns of myView accordingly
                    //
                    var CkBxGes  = document.getElementById( "ckboxGes"  ).checked;
                    var CkBxAnl  = document.getElementById( "ckboxAnl"  ).checked;
                    var CkBxCyc1 = document.getElementById( "ckboxCyc1" ).checked;
                    var CkBxCyc2 = document.getElementById( "ckboxCyc2" ).checked;
                    var CkBxCyc3 = document.getElementById( "ckboxCyc3" ).checked;
                    var CkBxCyc4 = document.getElementById( "ckboxCyc4" ).checked;

                    if( ! CkBxGes )  {
                        myView.hideColumns([3,4,5,6]);
                    }
                    if( ! CkBxAnl )  {
                        myView.hideColumns([7,8,9,10]);
                    }
                    if( !CkBxCyc1 ) {
                        myView.hideColumns([3,7]);
                    }
                    if( !CkBxCyc2 ) {
                        myView.hideColumns([4,8]);
                    }
                    if( !CkBxCyc3 ) {
                        myView.hideColumns([5,9]);
                    }
                    if( !CkBxCyc4 ) {
                        myView.hideColumns([6,10]);
                    }


                    // display the chart
                    chart1.draw(myView, options);

                    // rename the ckboxCyc1-4 labels using the input cycle times
                    document.getElementById( "labCyc1" ).innerHTML = dataProvider[0][0].cycle1;
                    document.getElementById( "labCyc2" ).innerHTML = dataProvider[0][0].cycle2;
                    document.getElementById( "labCyc3" ).innerHTML = dataProvider[0][0].cycle3;
                    document.getElementById( "labCyc4" ).innerHTML = dataProvider[0][0].cycle4;


                    /******************************************
                     *  chart2 is the total correction plot
                     ******************************************/
                    var options2 = {
                        title: 'Total Bias Correction (K)',
                        titleTextStyle:{ fontSize: 20 },
                        vAxis:{ format          : '0.##',
                            logScale        : 'false'},
                        hAxis:{ title           : 'Channel',
                            format          :  '##',
                            showTextEvery   :  1
                        }
                    };
                    var chart2 = new google.visualization.LineChart(
                            document.getElementById('total_bias_correction'));

                    // create a view for the display of only selected values
                    var myView2 = new google.visualization.DataView( data2 );

                    var CkBx1Cyc  = document.getElementById( "ckbox1Cyc" ).checked;
                    var CkBx1Day  = document.getElementById( "ckbox1Day").checked;
                    var CkBx30Day = document.getElementById( "ckbox30Day").checked;

                    if( ! CkBxGes ){
                        myView2.hideColumns([1,2,3]);
                    }
                    if( ! CkBxAnl ){
                        myView2.hideColumns([4,5,6]);
                    }
                    if( ! CkBx1Cyc ){
                        myView2.hideColumns([1,4]);
                    }
                    if( ! CkBx1Day ){
                        myView2.hideColumns([2,5]);
                    }
                    if( ! CkBx30Day){
                        myView2.hideColumns([3,6]);
                    }

                    //google.visualization.events.addListener(chart2, 'select', selectHandler);
                    chart2.draw(myView2, options2);


                    /******************************************************
                     *  chart3 is the om[g|a] plot for 1 cyc and 30 days
                     ******************************************************/
                    var options3 = {
                        title: 'Ges|Anl (with Bias Cor) - Observed (K)',
                        titleTextStyle:{ fontSize: 20 },
                        vAxis:{ format          : '0.##',
                            logScale        : 'false'},
                        hAxis:{ title           : 'Channel',
                            format          :  '##',
                            showTextEvery   :  1
                        }
                    };
                    var chart3 = new google.visualization.LineChart(
                            document.getElementById('ges_anl_m_obs_w_bias_cor'));

                    //-------------------------------------------------------
                    // create a view for the display of only selected values
                    var myView3 = new google.visualization.DataView( data3 );

                    //-------------------------------------------------------------------
                    // Poll all the checkboxes and set the columns of myView accordingly
                    //
                    var CkBx1CycAvg  = document.getElementById( "ckbox1CycAvg").checked;
                    var CkBx1CycSdv  = document.getElementById( "ckbox1CycSdv").checked;
                    var CkBx30DayAvg = document.getElementById( "ckbox30DayAvg").checked;
                    var CkBx30DaySdv = document.getElementById( "ckbox30DaySdv").checked;

                    if( ! CkBxGes ){
                        myView3.hideColumns([1,2,3,4]);
                    }
                    if( ! CkBxAnl ){
                        myView3.hideColumns([5,6,7,8]);
                    }
                    if( !CkBx1CycAvg) {
                        myView3.hideColumns([1,5]);
                    }
                    if( !CkBx1CycSdv){
                        myView3.hideColumns([2,6]);
                    }
                    if( !CkBx30DayAvg ){
                        myView3.hideColumns([3,7]);
                    }
                    if( !CkBx30DaySdv ){
                        myView3.hideColumns([4,8]);
                    }

                    //google.visualization.events.addListener(chart2, 'select', selectHandler);
                    chart3.draw(myView3, options3);


                    /***************************************************************************
                     *  chart4 is the contriubtion to penalty plot for 1 cyc, 1 day and 30 days
                     ***************************************************************************/
                    var options4 = {
                        title: 'Contribution to Penalty',
                        titleTextStyle:{ fontSize: 20 },
                        vAxis:{ format          : '0.##',
                            logScale        : 'false'},
                        hAxis:{ title           : 'Channel',
                            format          :  '##',
                            showTextEvery   :  1
                        }
                    };
                    var chart4 = new google.visualization.LineChart(
                            document.getElementById('contribution_to_penalty'));

                    // create a view for the display of only selected values
                    var myView4 = new google.visualization.DataView( data4 );

                    var CkBxPen1Cyc  = document.getElementById( "ckboxPen1Cyc" ).checked;
                    var CkBxPen1Day  = document.getElementById( "ckboxPen1Day").checked;
                    var CkBxPen30Day = document.getElementById( "ckboxPen30Day").checked;

                    if( ! CkBxGes ){
                        myView4.hideColumns([1,2,3]);
                    }
                    if( ! CkBxAnl ){
                        myView4.hideColumns([4,5,6]);
                    }
                    if( ! CkBxPen1Cyc ){
                        myView4.hideColumns([1,4]);
                    }
                    if( !CkBxPen1Day){
                        myView4.hideColumns([2,5]);
                    }
                    if( ! CkBxPen30Day){
                        myView4.hideColumns([3,6]);
                    }

                    //google.visualization.events.addListener(chart2, 'select', selectHandler);
                    chart4.draw(myView4, options4);

                    document.getElementById('title').innerHTML = 'Summary Plot   ' + src;
                    document.getElementById('valid').innerHTML = 'Valid:  ' + dataProvider[0][0].cycle1 ;


                    //------------------------------------------------------------------------------------
                    //  store current menu selections in parent.window.value so the current data
                    //  selections can be continued after switching plot types (time/angle/summary/bcoef)
                    //
                    //  Note that an attempt is made to preserve any set channel and stat selections from
                    //  other plot types.  This file (plot_summary.html) can only change the selected sat.
                    //------------------------------------------------------------------------------------
                    //var src    = new Uri( url ).getQueryParamValue('sat');

                    var curSelStr = parent.window.value;
                    var chan      = new Uri( curSelStr ).getQueryParamValue( 'channel' );
                    var stat      = new Uri( curSelStr ).getQueryParamValue( 'stat' );

                    var newSelStr = '?sat=' + src;
                    if( chan ) {
                        newSelStr = newSelStr + '&channel=' + chan;
                    }
                    if( stat ) {
                        newSelStr = newSelStr + '&stat=' + stat;
                    }
                    parent.window.value = newSelStr;

                    //log( "<-- fillCharts");
                }

                /************************************
                 *---------------------------------
                 *  drawCharts code begins here.
                 *---------------------------------
                 ************************************/

                //set platSelect to src, attach callback to platSelect after initial load is complete
                if( initialLoad ) {
                    var platSel = document.getElementById('platformSelect');
                    log( "src = " + src);
                    if( src == undefined ){
                        platSel.selectedIndex = 0;
                        src = platSel.options[platSel.selectedIndex].value;
                    }
                    else {
                        platSel.value = src;
                    }
                    log( "now src = " + src);

                    initialLoad = false;
                }

                var cntFile = './pngs/summary/' + src + '.sum.txt';

                // load data if this is the first time through this routine otherwise
                // skip if we're redrawing things.
                if (dataProvider.length <= 0) {
                    loadCSV( cntFile );

                }
                else{
                    fillCharts( );
                }
            }                   // end drawCharts


            // platSelect :  callback for change in select sat/instrument
            function platSelect( value ) {
                log( "--> platSelect " + value);
                //
                // dump all data and reload
                // attempt to reload curChan if that matches a value in the
                // new channel array, otherwise, start at 0.
                //

                // remove all previous channel numbers
                //var chanSel = document.getElementById("chanSelect");
                //while (chanSel.firstChild)
                //    chanSel.removeChild(chanSel.firstChild);

                // reset channel and chart data structures, reset curChan
                //chanData = [];
                //chartData  = [[]];
                //curChan  = 0;

                dataProvider = [];
                src = value;
                drawCharts();

                log( "<-- platSelect");
            }

        /*********************************************************************************
         * log
         *
         * used for debugging only.
         *
         * It dumps the input msg to the error console.  To see these messages open your
         * "web developer console" (actual term may vary with browser).
         * *******************************************************************************/
        function log(msg) {
            setTimeout(function() {
                throw new Error(msg);
            }, 0);
        }


        /***************************************************************
         * boxCheck
         *
         * redraws charts after a user change to any of the checkboxes.
         ***************************************************************/
        function boxCheck(value) {
            drawCharts( );
        }


        </SCRIPT>

        <style>
            h2{
                text-align: center;
            }
            h3{
                text-align: center;
            }
            .div_class{
                width: 1100px;
                height: 400px;
            }
        </style>

    </HEAD>

    <BODY>


        <h2 id=title > Summary Plot </h2>
        <h3 id=valid >Valid </h3>

        <label id="source" style="position: absolute; left: 2px; top:12px"><b> Source:</b></label>

        <label id="suffix" value="INSERT_SUFFIX" style="position: absolute; left: 72px; top:12px; color: blue"><b>INSERT_SUFFIX</b></label>

        <div id="sum_count" class="div_class"></div>
        <div id="total_bias_correction" class="div_class"></div>
        <div id="ges_anl_m_obs_w_bias_cor" class="div_class"></div>
        <div id="contribution_to_penalty" class="div_class"> </div>

        <form id="satSelectForm" action="" style="position:absolute; left:2px;top:40px">
            <b>Platform:</b>
            <select id="platformSelect" onChange="platSelect(this.value)">
                <!-- This menu will need to be customized by Install_html.sh on wcoss
                     It could be loaded using a php file, but that risks a condition where
                     a source might be missing for some reason, and we should know about that
                     if it was to happen, so it's better that a data load would fail here.  -->

                <!-- INSERT_TABLE -->
                <OPTION VALUE="airs_aqua"> AQUA AIRS </OPTION>
                <OPTION VALUE="amsua_aqua"> AQUA AMSU-A </OPTION>
                <OPTION VALUE="ssmis_f16"> F16 SSMIS </OPTION>
                <OPTION VALUE="ssmis_f17"> F17 SSMIS </OPTION>
                <OPTION VALUE="ssmis_f18"> F18 SSMIS </OPTION>
                <OPTION VALUE="sndrd1_g13"> GOES-13 SNDRD1 </OPTION>
                <OPTION VALUE="sndrd2_g13"> GOES-13 SNDRD2 </OPTION>
                <OPTION VALUE="sndrd3_g13"> GOES-13 SNDRD3 </OPTION>
                <OPTION VALUE="sndrd4_g13"> GOES-13 SNDRD4 </OPTION>
                <OPTION VALUE="sndrd1_g15"> GOES-15 SNDRD1 </OPTION>
                <OPTION VALUE="sndrd2_g15"> GOES-15 SNDRD2 </OPTION>
                <OPTION VALUE="sndrd3_g15"> GOES-15 SNDRD3 </OPTION>
                <OPTION VALUE="sndrd4_g15"> GOES-15 SNDRD4 </OPTION>
                <OPTION VALUE="seviri_m10"> M10 SEVIRI </OPTION>
                <OPTION VALUE="amsua_metop-a"> METOP-A AMSU-A </OPTION>
                <option value="avhrr_metop-a"> METOP-A AVHRR </option>
                <OPTION VALUE="hirs4_metop-a"> METOP-A HIRS/4 </OPTION>
                <OPTION VALUE="iasi_metop-a"> METOP-A IASI </OPTION>
                <OPTION VALUE="mhs_metop-a"> METOP-A MHS </OPTION>
                <OPTION VALUE="amsua_metop-b"> METOP-B AMSU-A </OPTION>
                <OPTION VALUE="hirs4_metop-b"> METOP-B HIRS/4 </OPTION>
                <OPTION VALUE="iasi_metop-b"> METOP-B IASI </OPTION>
                <OPTION VALUE="mhs_metop-b"> METOP-B MHS </OPTION>
                <OPTION VALUE="amsua_n15"> NOAA-15 AMSU-A </OPTION>
                <OPTION VALUE="amsua_n18"> NOAA-18 AMSU-A </OPTION>
                <option value="avhrr_n18"> NOAA-18 AVHRR </option>
                <OPTION VALUE="mhs_n18"> NOAA-18 MHS </OPTION>
                <OPTION VALUE="amsua_n19"> NOAA-19 AMSU-A </OPTION>
                <OPTION VALUE="hirs4_n19"> NOAA-19 HIRS/4 </OPTION>
                <OPTION VALUE="mhs_n19"> NOAA-19 MHS </OPTION>
                <OPTION VALUE="atms_npp"> NPP ATMS </OPTION>
                <OPTION VALUE="cris_npp"> NPP CRIS </OPTION>
                <!-- END_TABLE_INSERT -->
            </select>
        </form>

        <!--
           Notes on Compare With menu.
             - The value is keyed to the source name so the ckboxCmp value can be used within
               the javascript to locate the comparison source.  This limits the comparison to 1 but folks
               generally only want to see the data compared to the operational data or a control source.
             - The comp plots are problematic for comparisons because:
                o  graphic 1 is 4 discrete cycles.  The data files will often not completely coincide.
                o  graphics 2-4 use 1 cycle, 1 day ave, and 30 day avg values.  Again the time mismatch will
                   be a complication.
             - I'm going to comment out the comp box for now, and move on to the time plots, where the
               mismatch problem is more directly solvable.
        -->
        <!--
        <table style="position:absolute;left:1px;top:75px;width:150px">
            <caption> <b>Compare With:</b> </caption>
            <tr><td>
                <input type="checkbox" id="ckboxCmp" name="ckboxCmp" value="wopr" onclick="boxCheck(this.value)"><label for="ckboxCmp">opr GDAS</label></input>
            </td></tr>
        </table>
        -->

        <table style="position:absolute;left:1px;top:135px;width:150px">
           <caption> <b>Data Sets:</b> </caption>
            <tr><td>
                <input type="checkbox" id="ckboxGes" name="checkbox" value="gesdata" checked onclick="boxCheck(this.value)"><label for="ckboxGes">ges data</label></input>
            </td></tr>
            <tr><td>
                <input type="checkbox" id="ckboxAnl" name="checkbox" value="anldata" onclick="boxCheck(this.value)"><label for="ckboxAnl">anl data</label></input>
            </td></tr>
        </table>

        <table style="position:absolute;left:1px;top:220px;width:150px">
            <caption><b>Last 4 Cycles</b> </caption>
            <tr><td>
                <input type="checkbox" id="ckboxCyc1" name="checkbox" value="cycle1" checked onclick="boxCheck(this.value)"><label for="ckboxCyc1" id="labCyc1">cycle 1</label>
            </td></tr>
            <tr><td>
                <input type="checkbox" id="ckboxCyc2" name="checkbox" value="cycle2" checked onclick="boxCheck(this.value)"><label for="ckboxCyc2" id="labCyc2">cycle 2</label>
            </td></tr>
            <tr><td>
                <input type="checkbox" id="ckboxCyc3" name="checkbox" value="cycle3" checked onclick="boxCheck(this.value)"><label for="ckboxCyc3" id="labCyc3">cycle 3</label>
            </td></tr>
            <tr><td>
                <input type="checkbox" id="ckboxCyc4" name="checkbox" value="cycle4" checked onclick="boxCheck(this.value)"><label for="ckboxCyc4" id="labCyc4">cycle 4</label>
            </td></tr>
        </table>


<!-- NOTE:  30 Days (below) should be replaced with number of days determined on the fly -->
        <table style="position: absolute;left:1px;top:590px;width:150px">
            <caption><b>Period Averages</b></caption>
            <tr><td>
                <input type="checkbox" id="ckbox1Cyc" name="checkbox" value="1cycle" checked onclick="boxCheck(this.value)"><label for="ckbox1Cyc" id="lab1Cyc">1 Cycle</label></input>
            </td></tr>
            <tr><td>
                <input type="checkbox" id="ckbox1Day" name="checkbox" value="1day" checked onclick="boxCheck(this.value)"><label for="ckbox1Day" id="lab1Day">1 Day</label></input>
            </td></tr>
            <tr><td>
                <input type="checkbox" id="ckbox30Day" name="checkbox" value="30day" checked onclick="boxCheck(this.value)"><label for="ckbox30Day" id="lab30Day">30 Days</label></input>
            </td></tr>
        </table>

<!-- NOTE:  30 Days (below) should be replaced with number of days determined on the fly -->
        <table style="position: absolute;left:1px;top:990px;width:150px">
            <caption><b>Period Avg and Sdv</b></caption>
            <tr><td>
                <input type="checkbox" id="ckbox1CycAvg" name="checkbox" value="1cycleAvg" checked onclick="boxCheck(this.value)"><label for="ckbox1CycAvg" id="lab1CycAvg">1 Cycle Avg</label></input>
            </td></tr>
            <tr><td>
                <input type="checkbox" id="ckbox1CycSdv" name="checkbox" value="1cycleAvg" checked onclick="boxCheck(this.value)"><label for="ckbox1CycSdv" id="lab1CycSdv">1 Cycle Sdv</label></input>
            </td></tr>
            <tr><td>
                <input type="checkbox" id="ckbox30DayAvg" name="checkbox" value="30DayAvg" checked onclick="boxCheck(this.value)"><label for="ckbox30DayAvg" id="lab30DayAvg">30 Day Avg</label></input>
            </td></tr>
            <tr><td>
                <input type="checkbox" id="ckbox30DaySdv" name="checkbox" value="30DaySdv" checked onclick="boxCheck(this.value)"><label for="ckbox30DaySdv" id="lab30DaySdv">30 Day Sdv</label></input>
            </td></tr>
        </table>

<!-- NOTE:  30 Days (below) should be replaced with number of days determined on the fly -->
        <table style="position: absolute;left:1px;top:1390px;width:150px">
            <caption><b>Period Averages</b></caption>
            <tr><td>
                <input type="checkbox" id="ckboxPen1Cyc" name="checkbox" value="1cycle" checked onclick="boxCheck(this.value)"><label for="ckboxPen1Cyc" id="labPen1Cyc">1 Cycle</label></input>
            </td></tr>
            <tr><td>
                <input type="checkbox" id="ckboxPen1Day" name="checkbox" value="1day" checked onclick="boxCheck(this.value)"><label for="ckboxPen1Day" id="labPen1Day">1 Day</label></input>
            </td></tr>
            <tr><td>
                <input type="checkbox" id="ckboxPen30Day" name="checkbox" value="30day" checked onclick="boxCheck(this.value)"><label for="ckboxPen30Day" id="labPen30Day">30 Days</label></input>
            </td></tr>
        </table>

    </BODY>
</HTML>
